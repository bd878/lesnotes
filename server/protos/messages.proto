syntax = "proto3";

package messages.v1;

option go_package = "github.com/bd878/gallery/server/api";

service Messages {
	rpc GetServers(GetServersRequest) returns (GetServersResponse) {}
	rpc SaveMessage(SaveMessageRequest) returns (SaveMessageResponse) {}
	rpc DeleteMessages(DeleteMessagesRequest) returns (DeleteMessagesResponse) {}
	rpc DeleteUserMessages(DeleteUserMessagesRequest) returns (DeleteUserMessagesResponse) {}
	rpc PublishMessages(PublishMessagesRequest) returns (PublishMessagesResponse) {}
	rpc PrivateMessages(PrivateMessagesRequest) returns (PrivateMessagesResponse) {}
	rpc UpdateMessage(UpdateMessageRequest) returns (UpdateMessageResponse) {}
	rpc ReadMessage(ReadMessageRequest) returns (Message) {}
	rpc ReadMessages(ReadMessagesRequest) returns (ReadMessagesResponse) {}
	rpc ReadThreadMessages(ReadThreadMessagesRequest) returns (ReadThreadMessagesResponse) {}
	rpc ReadBatchMessages(ReadBatchMessagesRequest) returns (ReadBatchMessagesResponse) {}
}

message Message {
	int64    id = 1;
	int64    user_id = 2;
	int64    create_utc_nano = 3;
	int64    update_utc_nano = 4;
	string   text = 5;
	int64    thread_id = 6;
	bool     private = 7;
	string   name = 8;
	repeated int64 file_ids = 9;
}

message ReadThreadMessagesRequest {
	int64    user_id = 1;
	int64    thread_id = 2;
	int32    offset = 3;
	int32    limit = 4;
	bool     asc = 5;
}

message ReadThreadMessagesResponse {
	repeated Message messages = 1;
	bool             is_last_page = 2;
}

message ReadMessagesRequest {
	int64    user_id = 1;
	int32    offset = 2;
	int32    limit = 3;
	bool     asc = 4;
}

message ReadBatchMessagesRequest {
	int64    user_id = 1;
	repeated int64 ids = 2;
}

message ReadBatchMessagesResponse {
	repeated Message messages = 1;
}

message ReadMessagesResponse {
	repeated Message messages = 1;
	bool             is_last_page = 2;
}

message UpdateMessageRequest {
	int64    id = 1;
	int64    user_id = 2;
	int64    thread_id = 3;
	string   text = 4;
	int32    private = 5;
	repeated int64 file_ids = 6;
}

message UpdateMessageResponse {
}

message SaveMessageRequest {
	int64    id = 1;
	int64    user_id = 2;
	string   text = 3;
	int64    thread_id = 4;
	bool     private = 5;
	string   name = 6;
	repeated int64 file_ids = 7;
}

message SaveMessageResponse {
}

message DeleteUserMessagesRequest {
	int64    user_id = 1;
}

message DeleteUserMessagesResponse {}

message DeleteMessagesRequest {
	repeated int64  ids = 1;
	int64 user_id = 2;
}

message PublishMessagesRequest {
	repeated int64 ids = 1;
	int64 user_id = 2;
}

message PublishMessagesResponse {
	int64    update_utc_nano = 1;
}

message PrivateMessagesRequest {
	repeated int64 ids = 1;
	int64 user_id = 2;
}

message PrivateMessagesResponse {
	int64    update_utc_nano = 1;
}

message DeleteMessagesResponse {
}

message GetServersRequest {}

message GetServersResponse {
	repeated Server servers = 3;
}

message Server {
	string id = 1;
	string raft_addr = 2;
	bool   is_leader = 3;
}

message ReadMessageRequest {
	int64  id = 1;
	repeated int64  user_ids = 2;
}