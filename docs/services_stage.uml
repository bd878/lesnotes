@startuml

skinparam packageStyle rectangle

top to bottom direction

header LesNotes
title Staging environment

together {
	package users
	package files
	package messages
	package telemetry
	package sessions
	package front
	package search
}

package Front as front {
	component http as front_http
	front_http -- "192.168.10.3:8181"
}

package Telemetry as telemetry {
	component http as telemetry_http
	front_http -- "192.168.10.3:8179"
}

package Users as users {
	component http as users_http
	component grpc as users_grpc
	database PostgreSQL as users_db

	users_http -- "192.168.10.3:8184"
	users_grpc -- "192.168.10.3:8185"

	users_grpc - users_db
	users_http - users_grpc
}

package Files as files {
	component http as files_http
	component grpc as files_grpc
	database PostgreSQL as files_db

	files_http -- "192.168.10.3:8182"
	files_grpc -- "192.168.10.3:8186"

	files_grpc - files_db 
	files_http - files_grpc
}

package Messages as messages {
	component http as messages_http

	messages_http -- "192.168.10.3:8183"

	package "messages@9101" as 9101 {
		component grpc as 9101_grpc
		component serf as 9101_serf
		database PostgreSQL as 9101_db

		9101_grpc -- "192.168.10.3:9101"
		9101_serf -- "127.0.0.1:8171"
		9101_grpc - 9101_db
	}

	package "messages@9102" as 9102 {
		component grpc as 9102_grpc
		component serf as 9102_serf
		database PostgreSQL as 9102_db

		9102_grpc -- "192.168.10.3:9102"
		9102_serf -- "127.0.0.1:8172"
		9102_grpc - 9102_db
	}

	package "messages@9103" as 9103 {
		component grpc as 9103_grpc
		component serf as 9103_serf
		database PostgreSQL as 9103_db

		9103_grpc -- "192.168.10.3:9103"
		9103_serf -- "127.0.0.1:8173"
		9103_grpc - 9103_db
	}
}

package Sessions as sessions {
	component grpc as sessions_grpc
	database PostgreSQL as sessions_db

	sessions_grpc -- "192.168.10.3:8187"

	sessions_grpc - sessions_db
}

package Threads as threads {
	component grpc as threads_grpc
	component http as threads_http
	database PostgreSQL as threads_db

	threads_http -- "192.168.10.3:8188"
	threads_grpc -- "192.168.10.3:8189"

	threads_grpc - threads_db
	threads_http - threads_grpc
}

package Search as search {
	component http as search_http

	search_http -- "192.168.10.3:8190"

	package "search@9111" as 9111 {
		component grpc as 9111_grpc
		component serf as 9111_serf
		database PostgreSQL as 9111_db

		9111_grpc -- "192.168.10.3:9111"
		9111_serf -- "127.0.0.1:8271"
		9111_grpc -- 9111_db
	}

	package "search@9112" as 9112 {
		component grpc as 9112_grpc
		component serf as 9112_serf
		database PostgreSQL as 9112_db

		9112_grpc -- "192.168.10.3:9112"
		9112_serf -- "127.0.0.1:8272"
		9112_grpc -- 9112_db
	}

	package "search@9113" as 9113 {
		component grpc as 9113_grpc
		component serf as 9113_serf
		database PostgreSQL as 9113_db

		9113_grpc -- "192.168.10.3:9113"
		9113_serf -- "127.0.0.1:8273"
		9113_grpc -- 9113_db
	}
}

package Nats as nats {
	component tcp as nats_tcp

	nats_tcp -- "0.0.0.0:4222"
}

footer 21.10.25
@enduml
