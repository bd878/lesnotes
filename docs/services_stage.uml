@startuml

skinparam packageStyle rectangle

top to bottom direction

header LesNotes
title Staging environment

together {
	package users
	package files
	package messages
	package telemetry
	package sessions
	package front
	package search
}

package Front as front {
	component http as front_http
	front_http -- "192.168.10.3:8181"
}

package Users as users {
	component http as users_http

	users_http -- "192.168.10.3:8184"

	package "users@9121" as 9121 {
		component grpc as 9121_grpc
		component serf as 9121_serf
		database PostgreSQL as 9121_db

		9121_grpc -- "192.168.10.3:9121"
		9121_serf -- "192.168.10.3:8121"
		9121_grpc -- 9121_db
	}

	package "users@9122" as 9122 {
		component grpc as 9122_grpc
		component serf as 9122_serf
		database PostgreSQL as 9122_db

		9122_grpc -- "192.168.10.120:9122"
		9122_serf -- "192.168.10.120:8122"
		9122_grpc -- 9122_db
	}

	package "users@9123" as 9123 {
		component grpc as 9123_grpc
		component serf as 9123_serf
		database PostgreSQL as 9123_db

		9123_grpc -- "192.168.10.130:9123"
		9123_serf -- "192.168.10.130:8123"
		9123_grpc -- 9123_db
	}
}

package Files as files {
	component http as files_http
	component grpc as files_grpc
	database PostgreSQL as files_db

	files_http -- "192.168.10.5:8182"
	files_grpc -- "192.168.10.6:8186"

	files_grpc - files_db 
	files_http - files_grpc
}

package Messages as messages {
	component http as messages_http

	messages_http -- "192.168.10.3:8183"

	package "messages@9101" as 9101 {
		component grpc as 9101_grpc
		component serf as 9101_serf
		database PostgreSQL as 9101_db

		9101_grpc -- "192.168.10.3:9101"
		9101_serf -- "192.168.10.3:8101"
		9101_grpc - 9101_db
	}

	package "messages@9102" as 9102 {
		component grpc as 9102_grpc
		component serf as 9102_serf
		database PostgreSQL as 9102_db

		9102_grpc -- "192.168.10.120:9102"
		9102_serf -- "192.168.10.120:8102"
		9102_grpc - 9102_db
	}

	package "messages@9103" as 9103 {
		component grpc as 9103_grpc
		component serf as 9103_serf
		database PostgreSQL as 9103_db

		9103_grpc -- "192.168.10.130:9103"
		9103_serf -- "192.168.10.130:8103"
		9103_grpc - 9103_db
	}
}

package Sessions as sessions {
	package "sessions@9131" as 9131 {
		component grpc as 9131_grpc
		component serf as 9131_serf
		database PostgreSQL as 9131_db

		9131_grpc -- "192.168.10.3:9131"
		9131_serf -- "192.168.10.3:8131"
		9131_grpc - 9131_db
	}

	package "sessions@9132" as 9132 {
		component grpc as 9132_grpc
		component serf as 9132_serf
		database PostgreSQL as 9132_db

		9132_grpc -- "192.168.10.3:9132"
		9132_serf -- "192.168.10.3:8132"
		9132_grpc - 9132_db
	}

	package "sessions@9133" as 9133 {
		component grpc as 9133_grpc
		component serf as 9133_serf
		database PostgreSQL as 9133_db

		9133_grpc -- "192.168.10.3:9133"
		9133_serf -- "192.168.10.3:8133"
		9133_grpc - 9133_db
	}
}

package Threads as threads {
	component grpc as threads_grpc
	component http as threads_http
	database PostgreSQL as threads_db

	threads_http -- "192.168.10.3:8188"
	threads_grpc -- "192.168.10.3:8189"

	threads_grpc - threads_db
	threads_http - threads_grpc
}

package Search as search {
	component http as search_http

	search_http -- "192.168.10.3:8190"

	package "search@9111" as 9111 {
		component grpc as 9111_grpc
		component serf as 9111_serf
		database PostgreSQL as 9111_db

		9111_grpc -- "192.168.10.3:9111"
		9111_serf -- "192.168.10.3:8111"
		9111_grpc -- 9111_db
	}

	package "search@9112" as 9112 {
		component grpc as 9112_grpc
		component serf as 9112_serf
		database PostgreSQL as 9112_db

		9112_grpc -- "192.168.10.120:9112"
		9112_serf -- "192.168.10.120:8112"
		9112_grpc -- 9112_db
	}

	package "search@9113" as 9113 {
		component grpc as 9113_grpc
		component serf as 9113_serf
		database PostgreSQL as 9113_db

		9113_grpc -- "192.168.10.130:9113"
		9113_serf -- "192.168.10.130:8113"
		9113_grpc -- 9113_db
	}
}

package Nats as nats {
	component tcp as nats_tcp

	nats_tcp -- "192.168.10.3:4222"
}

footer 21.10.25
@enduml
